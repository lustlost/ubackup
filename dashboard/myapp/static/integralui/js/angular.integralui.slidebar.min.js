/*
  filename: angular.integralui.slidebar.min.js
  version : 1.0.0
  Copyright © 2014-2016 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUISlideBarService",["$rootScope","IntegralUIPublicService",function(b,m){return{addSlide:function(d,f){b.$broadcast(d+"-add-slide",f)},clearSlides:function(d){b.$broadcast(d+"-clear-slides")},insertSlideAt:function(d,f,g){b.$broadcast(d+"-insert-slide-at",f,g)},insertSlideBefore:function(d,f,g){b.$broadcast(d+"-insert-slide-before",f,g)},insertSlideAfter:function(d,f,g){b.$broadcast(d+"-insert-slide-after",f,g)},removeSlide:function(d,f){b.$broadcast(d+"-remove-slide",f)},removeSlideAt:function(d,f){b.$broadcast(d+"-remove-slide-at",f)},startAnimation:function(d){b.$broadcast(d+"-start-animation")},stopAnimation:function(d){b.$broadcast(d+"-stop-animation")},clearTempData:function(){tempData=null},getList:function(d,f){b.$broadcast(d+"-get-list",f);var g=this.getTempData();this.clearTempData();return g?g:[]},getTempData:function(){return tempData},setTempData:function(b){tempData=b},clearSelection:function(d){b.$broadcast(d+"-clear-selection")},selectedSlide:function(d,f){if(f)b.$broadcast(d+"-set-selected-slide",f);else{b.$broadcast(d+"-get-selected-slide");var g=this.getTempData();this.clearTempData();return g?g:null}},refresh:function(d){b.$broadcast(d+"-refresh")},resumeLayout:function(d){b.$broadcast(d+"-resume-layout")},suspendLayout:function(d){b.$broadcast(d+"-suspend-layout")},updateLayout:function(d){b.$broadcast(d+"-update-layout")}}}]).controller("IntegralUISlideBarController",["$scope","$element","IntegralUIInternalService","IntegralUIDataService","IntegralUISlideBarService",function(b,m,d,f,g){var c=this;c.defaultStyle={general:"iui-slidebar",navigation:{general:"iui-slidebar-navigation",button:{disabled:"iui-slidebar-navigation-button-disabled",normal:"iui-slidebar-navigation-button",hovered:"iui-slidebar-navigation-button-hovered",selected:"iui-slidebar-navigation-button-selected"}},slide:{general:"iui-slidebar-slide"}};c.options={};this.updateOptions=function(a){a?(c.options={allowAnimation:d.isFieldAvailable(a.allowAnimation,!0),animationPause:d.isFieldAvailable(a.animationPause,2E3),animationSpeed:d.isFieldAvailable(a.animationSpeed,"normal"),controlStyle:c.defaultStyle,enabled:d.isFieldAvailable(a.enabled,!0),selectedSlide:d.isFieldAvailable(a.selectedSlide,c.options.selectedSlide?c.options.selectedSlide:null),showNavigationPanel:d.isFieldAvailable(a.showNavigationPanel,!0)},c.updateDataFields(a.dataFields),c.updateControlStyle(a.controlStyle)):(c.options={allowAnimation:!0,animationPause:2E3,animationSpeed:"normal",controlStyle:c.defaultStyle,enabled:!0,selectedSlide:null,showNavigationPanel:!0},c.updateDataFields())};this.updateDataFields=function(a){c.options.dataFields=a?{content:a.content?a.content:"content",enabled:a.enabled?a.enabled:"enabled",id:a.id?a.id:"id",name:a.name?a.name:"name",selected:a.selected?a.selected:"selected",style:a.style?a.style:"style",text:a.text?a.text:"text",visible:a.visible?a.visible:"visible"}:{content:"content",enabled:"enabled",icon:"icon",id:"id",name:"name",selected:"selected",style:"style",text:"text",visible:"visible"};c.dataObj&&c.dataObj.updateDataFields(c.options.dataFields)};c.updateOptions();b.$on(b.name+"-add-slide",function(a,b){c.dataObj.insertAt(b,-1,null,c.slideIsAdded)});b.$on(b.name+"-clear-slides",function(a){c.dataObj.clear(null,c.listIsCleared)});b.$on(b.name+"-insert-slide-at",function(a,b,d){c.dataObj.insertAt(b,d,null,c.slideIsAdded)});b.$on(b.name+"-insert-slide-after",function(a,b,d){c.dataObj.insertByRef(b,d,!0,c.slideIsAdded)});b.$on(b.name+"-insert-slide-before",function(a,b,d){c.dataObj.insertByRef(b,d,!1,c.slideIsAdded)});b.$on(b.name+"-remove-slide",function(a,b){c.dataObj.removeAt(b,-1,null,c.slideIsRemoved)});b.$on(b.name+"-remove-slide-at",function(a,b){c.dataObj.removeAt(null,b,null,c.slideIsRemoved)});this.listIsCleared=function(){c.options.selectedSlide=null;c.updateLayout()};this.slideIsAdded=function(){c.updateLayout()};this.slideIsRemoved=function(a,b,d){a&&(a.selected=!1,a==c.options.selectedSlide&&(c.options.selectedSlide=null));c.updateLayout()};this.addSlideScope=function(a){a&&(c.slideScopeList.push(a),c.updateLayout&&c.updateLayout())};this.removeSlideScope=function(a){a=c.slideScopeList.indexOf(a);0<=a&&c.slideScopeList.splice(a,1)};b.$on(b.name+"-start-animation",function(a){c.startAnimation()});b.$on(b.name+"-stop-animation",function(a){c.stopAnimation()});this.currentList=[];this.currentScopeList=[];this.getCurrentList=function(){return c.currentList};this.updateCurrentList=function(){c.currentList.length=0;var a=c.dataObj.getList();if(a)for(var b=0;b<a.length;b++){var e=a[b];c.isSlideVisible(e)&&(e.type="slide",e[c.options.dataFields.id]||(e[c.options.dataFields.id]=d.getUniqueId()),c.currentList.push(e))}};this.updateCurrentScopeList=function(){for(var a=c.currentScopeList.length=0;a<c.currentList.length;a++){var b=c.getScopeBySlide(c.currentList[a]);b&&c.currentScopeList.push(b)}};this.slideScopeList=b.slideScopeList=[];this.dataEvents={clear:function(a){return angular.isDefined(b.events)&&b.events.clear?b.events.clear():b.clear()},objAdded:function(a){return angular.isDefined(b.events)&&b.events.slideAdded?b.events.slideAdded({slide:a.e.obj}):b.slideAdded(a)},objAdding:function(a){return angular.isDefined(b.events)&&b.events.slideAdding?b.events.slideAdding({slide:a.e.obj}):b.slideAdding(a)},objRemoved:function(a){return angular.isDefined(b.events)&&b.events.slideRemoved?b.events.slideRemoved({slide:a.e.obj}):b.slideRemoved(a)},objRemoving:function(a){return angular.isDefined(b.events)&&b.events.slideRemoving?b.events.slideRemoving({slide:a.e.obj}):b.slideRemoving(a)}};this.getDataFields=function(a){return{content:a.content?a.content:"content",id:a.id?a.id:"id",objects:a.slides?a.slides:"slides",text:a.text?a.text:"text"}};c.dataObj=new f({objects:b.slides,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)});this.allowEvents=!0;this.callButtonClicking=function(a){var c=!0;return c=angular.isDefined(b.events)&&b.events.buttonClicking?b.events.buttonClicking({index:a}):b.buttonClicking({e:{index:a}})};this.callButtonClicked=function(a){angular.isDefined(b.events)&&b.events.buttonClicked?b.events.buttonClicked({index:a}):b.buttonClicked({e:{index:a}})};this.callSlideChanged=function(a){angular.isDefined(b.events)&&b.events.slideChanged?b.events.slideChanged({slide:a}):b.slideChanged({e:{slide:a}})};this.callEnabledChanged=function(a){angular.isDefined(b.events)&&b.events.enabledChanged?b.events.enabledChanged({enabled:a}):b.enabledChanged({e:{enabled:a}})};this.callStyleChanged=function(a){angular.isDefined(b.events)&&b.events.styleChanged?b.events.styleChanged({style:a}):b.styleChanged({e:{style:a}})};b.$on(b.name+"-find-slide-by-id",function(a,b){g.setTempData(c.findSlideById(b))});b.$on(b.name+"-find-slide-by-text",function(a,b){g.setTempData(c.findSlideByText(b))});this.findSlideById=function(a){return c.dataObj.findObjectById(a)};this.findSlideByText=function(a){return c.dataObj.findObjectByText(a)};this.findSlideByName=function(a){var b=null,d=c.getList();if(d)for(var e=0;e<d.length;e++)if(d[e].name==a){b=d[e];break}return b};this.findScopeByName=function(a){for(var b=null,d=0;d<c.slideScopeList.length;d++)if(c.slideScopeList[d].name==a){b=c.slideScopeList[d];break}return b};b.$on(b.name+"-get-ctrl",function(a){d.setTempData(c)});b.$on(b.name+"-get-list",function(a,b){1==b?g.setTempData(c.getCurrentList()):g.setTempData(c.getList())});this.getSlideByScope=function(a){return a&&(a=c.getSlideScopeIndex(a),c.isIndexInRange(a))?c.currentList[a]:null};this.getSlideCurrentIndex=function(a){return a&&c.currentList?c.currentList.indexOf(a):-1};this.getSlideScopeIndex=function(a){return a&&c.currentScopeList?c.currentScopeList.indexOf(a):-1};this.getSlideState=function(a){if(a){if(0==c.options.enabled||0==a[c.options.dataFields.enabled])return"disabled";if(a==c.options.selectedSlide)return"selected";if(a==c.options.hoverSlide)return"hovered"}return"normal"};this.getScopeBySlide=function(a){return a?c.findScopeByName(a[c.options.dataFields.name]):null};this.getList=function(){return c.dataObj.getList()};this.isSlideEnabled=function(a){return d.isEnabled(a[c.options.dataFields.enabled])};this.isSlideVisible=function(a){return a&&0!=a[c.options.dataFields.visible]?!0:!1};this.isIndexInRange=function(a){return 0<=a&&a<c.currentList.length};c.allowUpdate=!0;this.suspendLayout=function(){c.allowUpdate=!1};this.resumeLayout=function(){c.allowUpdate=!0;c.updateLayout()};b.$on(b.name+"-refresh",function(a){c.refresh()});b.$on(b.name+"-resume-layout",function(a){c.resumeLayout()});b.$on(b.name+"-suspend-layout",function(a){c.suspendLayout()});b.$on(b.name+"-update-layout",function(a){c.updateLayout()});this.selectionCancelled=!1;b.$on(b.name+"-get-selected-slide",function(a){g.setTempData(c.slideSelection())});b.$on(b.name+"-set-selected-slide",function(a,b){c.slideSelection(b)});b.$on(b.name+"-clear-selection",function(a){c.options.selectedSlide&&(c.options.selectedSlide[c.options.dataFields.selected]=!1);c.options.selectedSlide=null});this.slideSelection=function(a,e){if(a){if(c.isSlideEnabled(a)){var f=c.slideSelection(),g=!0;f&&(g=!d.isEqual(f[c.options.dataFields.id],a[c.options.dataFields.id]));g&&(f=!0,f=angular.isDefined(b.events)&&b.events.slideChanging?b.events.slideChanging({slide:a}):b.slideChanging({e:{slide:a}}),c.selectionCancelled=0==f,0!=f&&(c.options.selectedSlide&&(c.options.selectedSlide.selected=!1),c.options.selectedSlide=a,a[c.options.dataFields.selected]=!0,c.callSlideChanged(a),c.updateLayout()))}}else return c.options.selectedSlide};this.selectSlide=function(a){(a=c.getSlideByScope(a))&&c.slideSelection(a)};var e=function(a){if(a){var b=d.isFieldAvailable(a.general,"iui-slidebar-navigation");a=a.button;a=d.isString(a)?a:a?{disabled:d.isFieldAvailable(a.disabled,"iui-slidebar-navigation-button-disabled"),normal:d.isFieldAvailable(a.normal,"iui-slidebar-navigation-button"),hovered:d.isFieldAvailable(a.hovered,"iui-slidebar-navigation-button-hovered"),selected:d.isFieldAvailable(a.selected,"iui-slidebar-navigation-button-selected")}:c.options.controlStyle.navigation.button;return{general:b,button:a}}return c.options.controlStyle.navigation},r=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-slidebar-slide")}:c.options.controlStyle.slide};this.updateControlStyle=function(a){c.options.controlStyle=a?{general:d.isFieldAvailable(a.general,"iui-slidebar"),navigation:e(a.navigation),slide:r(a.slide)}:{general:d.isFieldAvailable(c.defaultStyle.general,"iui-slidebar"),navigation:e(c.defaultStyle.navigation),slide:r(c.defaultStyle.slide)}};this.getCurrentNavigationStyle=function(){return c.options.controlStyle.navigation};this.getCurrentNavButtonStyle=function(a,b){if(!a)return"";switch(b){case "disabled":return a&&a.disabled?a.disabled:c.options.controlStyle.navigation.button.disabled;case "hovered":return a&&a.hovered?a.hovered:c.options.controlStyle.navigation.button.hovered;case "selected":return a&&a.selected?a.selected:c.options.controlStyle.navigation.button.selected;default:return a&&a.normal?a.normal:c.options.controlStyle.navigation.button.normal}};this.getCurrentSlideStyle=function(a){var b=c.options.controlStyle.slide;if(a)switch(a.style){case "initial":break;default:null!=a.style&&(b=a.style)}return b?b:c.options.controlStyle.slide};b.$watch("allowAnimation",function(a,b){a!==b&&(c.options.allowAnimation=a)});b.$watch("animationPause",function(a,b){a!==b&&(c.options.animationPause=a)});b.$watch("animationSpeed",function(a,b){a!==b&&(c.options.animationSpeed=a)});b.$watch("controlStyle",function(a,b){a!==b&&(c.options.controlStyle=a,c.refresh(),c.callStyleChanged(a))});b.$watch("enabled",function(a,b){a!==b&&(c.options.enabled=a,c.refresh(),c.options.allowAnimation=a,0!=a?c.startAnimation():c.stopAnimation(),c.callEnabledChanged(a))});b.$watch("fields",function(a,b){a!==b&&(c.options.dataFields=a,c.UpdateData())});b.$watch("options",function(a,b){a!==b&&(c.updateOptions(a),c.updateLayout())},!0);b.$watch("selectedSlide",function(a,b){a!==b&&c.slideSelection(a)});b.$watch("showNavigationPanel",function(a,b){a!==b&&(c.options.showNavigationPanel=a,c.updateLayout())})}]).directive("iuiSlidebar",["$timeout","$interval","IntegralUIInternalService",function(b,m,d){return{restrict:"EA",controller:"IntegralUISlideBarController",transclude:!0,replace:!0,template:'<div class="iui-slidebar" data-element="slidebar"><ul class="iui-slidebar-container" ng-transclude></ul></div>',scope:{allowAnimation:"=",animationPause:"=",animationSpeed:"@",controlStyle:"=",enabled:"=",fields:"=",name:"@",options:"=?",selectedSlide:"=",showNavigationPanel:"=",slides:"=",buttonClicked:"&",buttonClicking:"&",clear:"&",enabledChanged:"&",events:"=?",slideAdded:"&",slideAdding:"&",slideChanged:"&",slideChanging:"&",slideRemoved:"&",slideRemoving:"&",styleChanged:"&"},link:function(f,g,c,e,r){var a=this,p=angular.element(g.children().eq(0)),n=angular.element("<div></div>");f.$on("$destroy",function(b){a.s2t();y()});var q=null,v=null,z=function(){switch(e.options.animationSpeed){case "veryfast":return 25;case "fast":return 15;case "slow":return 5;case "veryslow":return 2}return 10},x=function(){q&&m.cancel(q);q=null;animationCounter=w.width};e.startAnimation=function(){v&&b.cancel(v);v=b(function(){x();if(0!=e.options.allowAnimation&&1<e.currentList.length){var a=e.getSlideCurrentIndex(e.options.selectedSlide),c=0,d=z();q=m(function(){c<w.width?(c+=d,p.css("margin-left",parseInt(p.css("margin-left"),10)-d+"px")):(c=0,x(),a++,e.isIndexInRange(a)?e.slideSelection(e.currentList[a]):e.slideSelection(e.currentList[0]))},10)}b.cancel(v)},e.options.animationPause)};e.stopAnimation=function(){x();if(p){var a=e.getSlideCurrentIndex(e.options.selectedSlide);p.css("margin-left",-(w.width*a)+"px")}};var y=function(){if(n)for(var a=n.find("span"),b=0;b<a.length;b++)angular.element(a[b]).unbind("mousedown")},A=function(){if(n)for(var a=n.find("span"),b=0;b<a.length;b++)angular.element(a[b]).bind("mousedown",function(a){a=angular.element(this);0!=e.options.enabled&&a[0].attributes&&a[0].attributes["data-index"]&&(a=a[0].attributes["data-index"].value,e.isIndexInRange(a)&&0!=e.callButtonClicking(a)&&(e.stopAnimation(),e.slideSelection(e.currentList[a]),e.callButtonClicked(a)))})},w={width:0,height:0};e.updateLayout=function(){if(e.allowUpdate){p.css("opacity",0);e.updateCurrentList();e.updateCurrentScopeList();!e.options.selectedSlide&&0<e.currentList.length&&(e.options.selectedSlide=e.currentList[0]);var a=b(function(){y();n.empty();if(e.options.showNavigationPanel){var c=e.getCurrentNavigationStyle();n.addClass(c.general);for(var f=e.getSlideCurrentIndex(e.options.selectedSlide),m="",h=0;h<e.currentScopeList.length;h++){var k=c.button.normal;h==f&&(k+=" "+c.button.selected);m+='<span class="'+k+'" data-index="'+h+'"></span>'}""!=m&&(c=angular.element(m),n.append(c),g.append(n),n.css("height",c[0].offsetHeight+"px"),A())}k=0;n&&(c=d.getMargin(n[0]),k=n[0].offsetHeight+c.top+c.bottom);var c=e.getSlideCurrentIndex(e.options.selectedSlide),l=null,f=0,m=g[0].clientHeight-k;w={width:g[0].clientWidth,height:g[0].clientHeight-k};for(h=0;h<e.currentScopeList.length;h++){for(var l=e.currentScopeList[h],l=l.name,u=null,q=g.find("li"),r=0;r<q.length;r++){var t=angular.element(q.eq(r));if(t&&t[0].attributes&&(t[0].attributes["data-name"]&&t[0].attributes["data-name"].value==l||t[0].attributes.name&&t[0].attributes.name.value==l)){u=t;break}}if(l=u)u=d.getBorderWidth(l[0]),d.getPadding(l[0]),l.css("width",g[0].clientWidth-(u.left+u.right)+"px"),l.css("height",g[0].clientHeight-k+"px"),f+=g[0].clientWidth}k=[];l=p.find("li");for(h=e.currentScopeList.length;h<l.length;h++)k.push(angular.element(l[h]));for(h=0;h<k.length;h++)k[h].remove();h=angular.element(p.find("li").eq(0)).clone();p.append(h);f+=g[0].clientWidth;p.css("width",f+"px");p.css("height",m+"px");p.css("margin-left",0);0<=c&&p.css("margin-left",-(g[0].clientWidth*c)+"px");p.css("opacity",1);e.startAnimation();b.cancel(a)},1)}};e.refresh=function(){if(n){var a=e.getCurrentNavigationStyle(),b=a.button.normal;0==e.options.enabled&&a.button.disabled&&d.isString(a.button.disabled)&&(b+=" "+a.button.disabled);for(var c=b,f=e.getSlideCurrentIndex(e.options.selectedSlide),g=n.find("span"),k=0;k<g.length;k++){var l=angular.element(g[k]),b=c;k==f&&(b+=" "+a.button.selected);l.removeAttr("class");l.addClass(b)}}};this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(a.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",g[0].scrollTop+"px"),this.$tw.css("left",g[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",g[0].scrollTop+"px"),this.$tw.css("left",g[0].scrollLeft+"px"))};this.s1t=function(c){this.trlTime=b(function(){a.trActive||(a.trCount=0,a.trActive=!0,a.trId=m(function(){a.animTr()},1E3))},c)};this.s2t=function(){this.trId&&(m.cancel(this.trId),this.trId=null);this.trlTime&&(b.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};g.append(this.$tw);this.s1t(this.twp);angular.isDefined(f.options)?e.updateOptions(f.options):(0==f.allowAnimation&&(e.options.allowAnimation=f.allowAnimation),angular.isDefined(f.animationPause)&&(e.options.animationPause=f.animationPause),angular.isDefined(f.animationSpeed)&&(e.options.animationSpeed=f.animationSpeed),angular.isDefined(f.controlStyle)&&e.updateControlStyle(f.controlStyle),0==f.enabled&&(e.options.enabled=f.enabled),angular.isDefined(f.fields)&&e.updateDataFields(f.fields),0<=f.selectedIndex&&(e.options.selectedIndex=f.selectedIndex),angular.isDefined(f.selectedSlide)&&(e.options.selectedSlide=f.selectedSlide),0==f.showNavigationPanel&&(e.options.showNavigationPanel=f.showNavigationPanel));b(function(){e.updateLayout()},1)}}}]).controller("IntegralUISlideController",["$scope","$element","IntegralUIInternalService",function(b,m,d){var f=this;b.$on(b.name+"-get-ctrl",function(b){d.setTempData(f)})}]).directive("iuiSlide",["$timeout","IntegralUIInternalService",function(b,m){return{require:"^iuiSlidebar",restrict:"EA",controller:"IntegralUISlideController",transclude:!0,replace:!0,template:'<li class="iui-slidebar-slide" ng-transclude data-element="slide"></li>',scope:{name:"@"},link:function(b,f,g,c,e){b.$on("$destroy",function(e){c.removeSlideScope(b)});c.addSlideScope(b)}}}]);