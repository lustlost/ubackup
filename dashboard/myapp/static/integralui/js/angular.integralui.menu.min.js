/*
  filename: angular.integralui.menu.min.js
  version : 1.0.7
  Copyright © 2014-2016 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUIMenuService",["$rootScope","IntegralUIPublicService",function(c,y){return{addItem:function(f,g,m){c.$broadcast(f+"-add-item",g,m)},clearItems:function(f,g){c.$broadcast(f+"-clear-items",g)},insertItemAt:function(f,g,m,k){c.$broadcast(f+"-insert-item-at",g,m,k)},insertItemBefore:function(f,g,m){c.$broadcast(f+"-insert-item-before",g,m)},insertItemAfter:function(f,g,m){c.$broadcast(f+"-insert-item-after",g,m)},removeItem:function(f,g){c.$broadcast(f+"-remove-item",g)},removeItemAt:function(f,g,m){c.$broadcast(f+"-remove-item-at",g,m)},exportToJSON:function(f,g,m,k){c.$broadcast(f+"-export-json",g,m,k);f=this.getTempData();this.clearTempData();return f?f:""},loadData:function(f,g,m,k,d){c.$broadcast(f+"-load-data",g,m,k,d)},findItemById:function(f,g){c.$broadcast(f+"-find-item-by-id",g);var m=this.getTempData();this.clearTempData();return m?m:null},findItemByText:function(f,g){c.$broadcast(f+"-find-item-by-text",g);var m=this.getTempData();this.clearTempData();return m?m:null},getList:function(f,g,m){c.$broadcast(f+"-get-list",g,m);f=this.getTempData();this.clearTempData();return f?f:[]},beginLoad:function(f,g){c.$broadcast(f+"-begin-load",g)},closeMenu:function(f,g){c.$broadcast(f+"-close-menu",g)},endLoad:function(f){c.$broadcast(f+"-end-load")},openMenu:function(f,g){c.$broadcast(f+"-open-menu",g)},refresh:function(f){c.$broadcast(f+"-refresh")},resumeLayout:function(f){c.$broadcast(f+"-resume-layout")},suspendLayout:function(f){c.$broadcast(f+"-suspend-layout")},updateLayout:function(f,g){c.$broadcast(f+"-update-layout",g)}}}]).controller("IntegralUIMenuController",["$scope","$element","IntegralUIInternalService","IntegralUIDataService","IntegralUIMenuService","$timeout",function(c,y,f,g,m,k){var d=this;d.hoverItem=null;d.defaultStyle={general:{disabled:"iui-menu-disabled",normal:"iui-menu"},block:{general:"iui-menu-block",marker:{top:"iui-menu-marker-top",left:"iui-menu-marker-left",bottom:"iui-menu-marker-bottom",right:"iui-menu-marker-right",rtlTop:"iui-menu-marker-top-rtl",expand:{down:"iui-menu-marker-expand-down",right:"iui-menu-marker-expand-right",rtlDown:"iui-menu-marker-expand-down-rtl",up:"iui-menu-marker-expand-up",left:"iui-menu-marker-expand-left",rtlSpace:"iui-menu-marker-expand-space-rtl",space:"iui-menu-marker-expand-space"}}},item:{general:{disabled:"iui-menu-item-disabled",focused:"iui-menu-item-focused",normal:"iui-menu-item",hovered:"iui-menu-item-hovered",selected:"iui-menu-item-selected"},content:"iui-menu-item-content",loadIcon:{general:"iui-menu-load",icon:"iui-submenu-load-icon"},separator:"iui-menu-item-separator"},root:{general:{disabled:"iui-menu-item-root-disabled",focused:"iui-menu-item-root-focused",normal:"iui-menu-item-root",hovered:"iui-menu-item-root-hovered",selected:"iui-menu-item-root-selected",vertical:"iui-menu-item-root-vertical"},content:"iui-menu-item-root-content",loadIcon:{general:"iui-menu-load",icon:"iui-menu-load-icon"},separator:"iui-menu-root-separator"}};this.updateOptions=function(b){b?(d.options={controlStyle:f.isFieldAvailable(b.controlStyle,d.defaultStyle),displayMode:f.isFieldAvailable(b.displayMode,"horizontal"),enabled:f.isFieldAvailable(b.enabled,!0),itemIcon:f.isFieldAvailable(b.itemIcon,""),openOnHover:f.isFieldAvailable(b.openOnHover,!1),rtl:f.isFieldAvailable(b.rtl,!1),showDropDownIcon:f.isFieldAvailable(b.showIcons,!1),showIcons:f.isFieldAvailable(b.showIcons,!0)},d.updateDataFields(b.dataFields),d.updateControlStyle(b.controlStyle)):(d.options={controlStyle:d.defaultStyle,displayMode:"horizontal",enabled:!0,itemIcon:"",openOnHover:!1,rtl:!1,showDropDownIcon:!1,showIcons:!0},d.updateDataFields())};d.options={};this.updateDataFields=function(b){d.options.dataFields=b?{enabled:b.enabled?b.enabled:"enabled",hasChildren:b.hasChildren?b.hasChildren:"hasChildren",icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",items:b.items?b.items:"items",pid:b.pid?b.pid:"pid",selected:b.selected?b.selected:"selected",style:b.style?b.style:"style",text:b.text?b.text:"text",type:b.type?b.type:"type",value:b.value?b.value:"value"}:{enabled:"enabled",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",selected:"selected",style:"style",text:"text",type:"type",value:"value"};d.dataObj&&d.dataObj.updateDataFields(d.options.dataFields)};d.updateOptions();c.$on(c.name+"-add-item",function(b,a,e){d.dataObj.insertAt(a,-1,e,d.itemIsAdded)});c.$on(c.name+"-clear-items",function(b,a){d.dataObj.clear(a,d.listIsCleared)});c.$on(c.name+"-insert-item-at",function(b,a,e,c){d.dataObj.insertAt(a,e,c,d.itemIsAdded)});c.$on(c.name+"-insert-item-after",function(b,a,c){d.dataObj.insertByRef(a,c,!0,d.itemIsAdded)});c.$on(c.name+"-insert-item-before",function(b,a,c){d.dataObj.insertByRef(a,c,!1,d.itemIsAdded)});c.$on(c.name+"-remove-item",function(b,a){d.dataObj.removeAt(a,-1,null,d.itemIsRemoved)});c.$on(c.name+"-remove-item-at",function(b,a,c){d.dataObj.removeAt(null,a,c,d.itemIsRemoved)});this.listIsCleared=function(b){d.updateLayout()};this.itemIsAdded=function(){d.updateLayout()};this.itemIsRemoved=function(){d.updateLayout()};d.currentList=[];d.isThereChildItems=!1;var B=function(b,a,c){b.type||(b.type="item",d.isRoot(b)&&(b.type="root"));b[d.options.dataFields.id]||(b[d.options.dataFields.id]=f.getUniqueId());a&&(b[d.options.dataFields.pid]=a);c?d.fullList.push(b):d.currentList.push(b)},a=function(b,c,e){if(b[d.options.dataFields.items]){if(B(b,c,e),c=b[d.options.dataFields.items])for(var f=0;f<c.length;f++)a(c[f],b[d.options.dataFields.id],e)}else B(b,c,e)};d.fullList=[];this.getFullList=function(b){return d.fullList};this.updateFullList=function(){d.fullList.length=0;var b=d.dataObj.getList();if(b)for(var c=0;c<b.length;c++)a(b[c],null,!0);return d.fullList};this.getCurrentList=function(){return d.currentList};this.updateCurrentList=function(){d.currentList.length=0;var b=d.dataObj.getList();if(b)for(var a=0;a<b.length;a++)B(b[a],0,null,!1)};this.getItemFullIndex=function(b){return b&&d.fullList?d.fullList.indexOf(b):-1};this.getDataFields=function(b){return{icon:b.icon?b.icon:"icon",id:b.id?b.id:"id",pid:b.pid?b.pid:"pid",objects:b.items?b.items:"items",text:b.text?b.text:"text"}};d.dataObj=new g({objects:c.items,events:{clear:function(b){return angular.isDefined(c.events)&&c.events.clear?c.events.clear({parent:b.e.parent}):c.clear(b)},objAdded:function(b){return angular.isDefined(c.events)&&c.events.itemAdded?c.events.itemAdded({item:b.e.item}):c.itemAdded(b)},objAdding:function(b){return angular.isDefined(c.events)&&c.events.itemAdding?c.events.itemAdding({item:b.e.item}):c.itemAdding(b)},objRemoved:function(b){return angular.isDefined(c.events)&&c.events.itemRemoved?c.events.itemRemoved({item:b.e.item}):c.itemRemoved(b)},objRemoving:function(b){return angular.isDefined(c.events)&&c.events.itemRemoving?c.events.itemRemoving({item:b.e.item}):c.itemRemoving(b)}},fields:d.getDataFields(d.options.dataFields)});c.$on(c.name+"-load-data",function(b,a,c,f,g){d.loadData(a,c,f,g)});c.$on(c.name+"-export-json",function(b,a,c,f){m.setTempData(d.exportToJSON(a,c,f))});this.exportToJSON=function(b,a,c){c=c?c:null;var f=0!=a?d.getFullList():d.dataObj.getList();b=b?b:[d.options.dataFields.enabled,d.options.dataFields.icon,d.options.dataFields.id,d.options.dataFields.hasChildren,d.options.dataFields.pid,d.options.dataFields.style,d.options.dataFields.text,d.options.dataFields.type,d.options.dataFields.value];0==a&&b.push(d.options.dataFields.items);return JSON.stringify(f,b,c)};this.loadData=function(b,a,f,m){d.allowEvents=!1;d.updateDataFields(f);var k=[],q=d.options.dataFields;d.dataObj.clear(a);if(b)if(0!=m){var n=[];b.forEach(function(b,a){var d=b[q.pid];n[d]?(n[d][q.items]||(n[d][q.items]=[]),n[b[q.id]]=b,n[d][q.items].push(b)):(n[b[q.id]]=b,k.push(b))});n.length=0}else k=b;if(a)for(a[d.options.dataFields.items]=k,b=0;b<a[d.options.dataFields.items].length;b++)a[d.options.dataFields.items][b][d.options.dataFields.pid]=a[d.options.dataFields.id];else angular.isDefined(c.items)&&(c.items=k);d.dataObj=new g({objects:c.items,events:d.dataEvents,fields:d.getDataFields(d.options.dataFields)});d.updateLayout(a);d.allowEvents=!0};this.callClose=function(b){var a=!0;return a=angular.isDefined(c.events)&&c.events.close?c.events.close({item:b}):c.close({e:{item:b}})};this.callItemClick=function(b,a){var d=!0;return d=angular.isDefined(c.events)&&c.events.itemClick?c.events.itemClick({item:b,mousePos:a}):c.itemClick({e:{item:b,mousePos:a}})};this.callItemHover=function(b){angular.isDefined(c.events)&&c.events.itemHover?c.events.itemHover({item:b}):c.itemHover({e:{item:b}})};this.callEnabledChanged=function(b){angular.isDefined(c.events)&&c.events.enabledChanged?c.events.enabledChanged({enabled:b}):c.enabledChanged({e:{enabled:b}})};this.callOpen=function(b){var a=!0;return a=angular.isDefined(c.events)&&c.events.open?c.events.open({item:b}):c.open({e:{item:b}})};this.callStyleChanged=function(b){angular.isDefined(c.events)&&c.events.styledChanged?c.events.styleChanged({style:b}):c.styleChanged({e:{style:b}})};c.$on(c.name+"-get-list",function(b,a,c){1==c?m.setTempData(d.getFullList(a)):m.setTempData(d.getList(a))});this.getElemFromItem=function(b){var a=null;if(b){b=d.getItemFullIndex(b);var c=y.find("li");if(c&&0<c.length)for(var f=0;f<c.length;f++){var g=angular.element(c[f]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===b.toString()){a=g;break}}}return a};this.getBlockElemFromItem=function(b){var a=null;b&&(b=d.getElemFromItem(b))&&(b=b.find("ul"),0<b.length&&(a=angular.element(b.eq(0))));return a};this.getItemFromChildElem=function(b){return b?(b=angular.element(b))?d.getItemFromElem(b[0].parentElement):null:null};this.getItemFromElem=function(b){if(b&&(b=angular.element(b))&&b[0].attributes["data-index"]&&(b=b[0].attributes["data-index"].value,d.isIndexInRange(b)))return d.fullList[b]};this.getObjState=function(b){if(b&&"separator"!=b.type){if(0==d.options.enabled||0==b[d.options.dataFields.enabled])return"disabled";if(b==d.hoverItem)return"hovered";if(1==b[d.options.dataFields.selected])return"selected"}return"normal"};this.getItemIndex=function(b){var a=d.getParent(b),a=d.getList(a);return d.dataObj.getIndexOf(b,a)};this.getParent=function(b){return d.dataObj.getParent(b)};this.getList=function(b){return d.dataObj.getList(b)};this.isIndexInRange=function(b){return 0<=b&&b<d.fullList.length};this.isItemEnabled=function(b){return b?f.isEnabled(b[d.options.dataFields.enabled]):!1};this.isRoot=function(b){return!b||void 0!=b[d.options.dataFields.pid]&&null!=b[d.options.dataFields.pid]?!1:!0};d.allowUpdate=!0;this.suspendLayout=function(){d.allowUpdate=!1};this.resumeLayout=function(){d.allowUpdate=!0;d.updateLayout()};c.$on(c.name+"-refresh",function(b){d.refresh(null,!0)});c.$on(c.name+"-resume-layout",function(b){d.resumeLayout()});c.$on(c.name+"-suspend-layout",function(b){d.suspendLayout()});c.$on(c.name+"-update-layout",function(b,a){d.updateLayout(a)});c.$on(c.name+"-begin-load",function(b,a){var c=k(function(){d.options.loadItem=a;d.refresh(null,!0);k.cancel(c)},1)});c.$on(c.name+"-close-menu",function(b,a){d.closeItem(a);d.refresh(null,!0)});c.$on(c.name+"-end-load",function(b){var a=k(function(){d.options.loadItem=null;d.refresh(null,!0);k.cancel(a)},1)});c.$on(c.name+"-open-menu",function(b,a){d.openItem(a)});c.$watch("controlStyle",function(a,c){a!==c&&(d.options.controlStyle=a,d.refresh(null,!0),d.callStyleChanged(a))});c.$watch("enabled",function(a,c){a!==c&&(d.options.enabled=a,d.updateLayout(),d.callEnabledChanged(a))});c.$watch("openOnHover",function(a,c){a!==c&&(d.options.openOnHover=a,d.updateLayout())});c.$watch("displayMode",function(a,c){a!==c&&(d.options.displayMode=a,d.updateLayout())});c.$watch("options",function(a,c){a!==c&&d.updateOptions(a)},!0);c.$watch("rtl",function(a,c){a!==c&&(d.options.rtl=a,d.updateLayout())});c.$watch("showIcons",function(a,c){a!==c&&(d.options.showIcons=a,d.updateLayout())});var E=function(a){if(a){var c=f.isFieldAvailable(a.general,"iui-menu-block");var e=a.marker;if(e){a=f.isFieldAvailable(e.top,"iui-menu-marker-top");var g=f.isFieldAvailable(e.left,"iui-menu-marker-left"),k=f.isFieldAvailable(e.bottom,"iui-menu-marker-bottom"),m=f.isFieldAvailable(e.right,"iui-menu-marker-right"),e=(e=e.expand)?{down:f.isFieldAvailable(e.down,"iui-menu-marker-expand-down"),right:f.isFieldAvailable(e.right,"iui-menu-marker-expand-right"),up:f.isFieldAvailable(e.up,"iui-menu-marker-expand-up"),left:f.isFieldAvailable(e.left,"iui-menu-marker-expand-left"),space:f.isFieldAvailable(e.space,"iui-menu-marker-expand-space")}:d.options.controlStyle.block.marker.expand;a={top:a,left:g,bottom:k,right:m,expand:e}}else a=d.options.controlStyle.block.marker;return{general:c,marker:a}}return d.options.controlStyle.block},u=function(a){if(a){var c;c=(c=a.general)?{disabled:f.isFieldAvailable(c.disabled,"iui-menu-item-disabled"),focused:f.isFieldAvailable(c.focused,"iui-menu-item-focused"),normal:f.isFieldAvailable(c.normal,"iui-menu-item"),hovered:f.isFieldAvailable(c.hovered,"iui-menu-item-hovered"),selected:f.isFieldAvailable(c.selected,"iui-menu-item-selected")}:d.options.controlStyle.item.general;var e=f.isFieldAvailable(a.content,"iui-menu-item-content"),g;g=(g=a.loadIcon)?{general:f.isFieldAvailable(g.general,"iui-menu-load"),icon:f.isFieldAvailable(g.icon,"iui-submenu-load-icon")}:d.options.controlStyle.item.loadIcon;return{general:c,content:e,loadIcon:g,separator:f.isFieldAvailable(a.separator,"iui-menu-item-separator")}}return d.options.controlStyle.item},w=function(a){if(a){var c;c=(c=a.general)?{disabled:f.isFieldAvailable(c.disabled,"iui-menu-item-root-disabled"),focused:f.isFieldAvailable(c.focused,"iui-menu-item-root-focused"),normal:f.isFieldAvailable(c.normal,"iui-menu-item-root"),hovered:f.isFieldAvailable(c.hovered,"iui-menu-item-root-hovered"),selected:f.isFieldAvailable(c.selected,"iui-menu-item-root-selected"),vertical:f.isFieldAvailable(c.vertical,"iui-menu-item-root-vertical")}:d.options.controlStyle.root.general;var e=f.isFieldAvailable(a.content,"iui-menu-item-root-content"),g;g=(g=a.loadIcon)?{general:f.isFieldAvailable(g.general,"iui-menu-load"),icon:f.isFieldAvailable(g.icon,"iui-menu-load-icon")}:d.options.controlStyle.root.loadIcon;return{general:c,content:e,loadIcon:g,separator:f.isFieldAvailable(a.separator,"iui-menu-root-separator")}}return d.options.controlStyle.root};this.getCurrentItemStyle=function(a,c){var e=d.options.controlStyle.item;if(a)switch(a.style){case "initial":break;case "parent":return d.getCurrentItemStyle(d.getParent(a),c);default:null!=a.style&&(e=a.style)}if(c){if(f.isString(e.general))return e.general;switch(c){case "disabled":return e.general&&e.general.disabled?e.general.disabled:d.options.controlStyle.item.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:d.options.controlStyle.item.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:d.options.controlStyle.item.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:d.options.controlStyle.item.general.selected;default:return e.general&&e.general.normal?e.general.normal:d.options.controlStyle.item.general.normal}}else return e?e:d.options.controlStyle.item};this.getCurrentRootStyle=function(a,c){var e=d.options.controlStyle.root;if(a)switch(a.style){case "initial":break;default:null!=a.style&&(e=a.style)}if(c){if(f.isString(e.general))return e.general;switch(c){case "disabled":return e.general&&e.general.disabled?e.general.disabled:d.options.controlStyle.root.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:d.options.controlStyle.root.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:d.options.controlStyle.root.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:d.options.controlStyle.root.general.selected;default:return e.general&&e.general.normal?e.general.normal:d.options.controlStyle.root.general.normal}}else return e?e:d.options.controlStyle.root};var A=function(a){return a?f.isString(a)?a:{disabled:f.isFieldAvailable(a.disabled,"iui-menu-disabled"),normal:f.isFieldAvailable(a.normal,"iui-menu")}:d.defaultStyle.general};this.updateControlStyle=function(a){d.options.controlStyle=a?{general:A(a.general),block:E(a.block),item:u(a.item),root:w(a.root)}:{general:A(d.defaultStyle.general),block:E(d.defaultStyle.block),item:u(d.defaultStyle.item),root:w(d.defaultStyle.root)}}}]).directive("iuiMenu",["$compile","$window","$timeout","$interval","IntegralUIInternalService",function(c,y,f,g,m){return{restrict:"EA",controller:"IntegralUIMenuController",transclude:!0,replace:!0,template:'<div class="iui-menu" data-element="menu"><ul class="iui-menu-block"></ul></div>',scope:{controlStyle:"=",enabled:"=",itemIcon:"=",items:"=",name:"@",openOnHover:"=",options:"=?",displayMode:"@",rtl:"=",showDropdownIcon:"=",showIcons:"=",close:"&",enabledChanged:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemClick:"&",itemHover:"&",itemRemoved:"&",itemRemoving:"&",open:"&",styleChanged:"&"},link:function(k,d,B,a,E){var u=d.children().eq(0),w=function(a){d.unbind("mouseleave");a=a?a.find("li"):u.children();if(0<a.length)for(var b=0;b<a.length;b++)currentElem=angular.element(a[b]),currentElem.unbind("click mouseenter mouseleave touchstart")},A=function(c){if(1==a.options.enabled){var f=null;d.bind("mouseleave",function(a){a.stopPropagation()});c=c?c.find("li"):u.children();if(0<c.length)for(var F=null,e=0;e<c.length;e++)F=angular.element(c[e]),(f=a.getItemFromElem(F))&&a.isItemEnabled(f)&&b(F)}},b=function(b){b&&(b.bind("click",function(b){var c=a.getItemFromElem(this);c&&0!=a.callItemClick(c,m.getMousePos(b))&&(a.isRoot(c)?(angular.element(this),t?(a.closeItem(c),a.isRoot(c)&&(t=!1,e=null)):a.openItem(c)):z(c)||q());b.stopPropagation()}),b.bind("mouseenter",function(b){var c=a.getItemFromElem(this);c&&(angular.element(this),a.hoverItem=c,a.refresh(null,!0),a.callItemHover(c),a.options.openOnHover||!a.isRoot(c)?(n&&f.cancel(n),n=f(function(){n&&a.openItem(c)},500)):t&&c!=e&&(e&&a.closeItem(e),a.openItem(c)));b.stopPropagation()}),b.bind("mouseleave",function(c){a.hoverItem=null;var b=a.getItemFromElem(this);if(b&&(a.refresh(null,!0),!a.options.openOnHover&&e&&(e[a.options.dataFields.selected]=!0,a.refresh(e)),a.options.openOnHover||!a.isRoot(b)))var d=f(function(){a.closeItem(b);f.cancel(d)},250);n&&f.cancel(n);n=null}),b.bind("touchstart",function(c){c.preventDefault();var b=m.getTouchData(c);b&&0<b.length&&((b=a.getItemFromElem(this))&&0!=a.callItemClick(b,m.getMousePos(c))&&(a.isRoot(b)?(angular.element(this),t?(a.closeItem(b),a.isRoot(b)&&(t=!1,e=null)):a.openItem(b)):z(b)||q()),c.stopPropagation())}))};angular.element(y).bind("click",function(a){q()});angular.element(y).bind("keydown",function(b){switch(b.keyCode){case 27:a.closeItem(e),t=!1,e=null,a.refresh(null,!0)}});var t=!1,e=null,v=[],C=function(b){return b?(b=b[a.options.dataFields.items],void 0!=b&&0<b.length):!1};a.openItem=function(b){var c=a.getElemFromItem(b);if(b&&z(b)&&p&&c){var d=c.find("ul");if(0<d.length&&0!=a.callOpen(b)){d=angular.element(d.eq(0));w(d);C(b)&&(c.removeClass(a.options.controlStyle.block.marker.expand.down),c.removeClass(a.options.controlStyle.block.marker.expand.left),c.removeClass(a.options.controlStyle.block.marker.expand.right),c.removeClass(a.options.controlStyle.block.marker.expand.rtlDown));t=!0;(e=a.isRoot(b)?b:e)&&(e[a.options.dataFields.selected]=!0);0>v.indexOf(e)&&v.unshift(e);for(var g=0;g<v.length;g++)v[g]!=e&&(v[g][a.options.dataFields.selected]=!1,a.closeItem(v[g]));v.splice(1,v.length-1);if(C(b)){g=a.getItemIndex(b);if(0<=g){var r=0,l="auto",h="auto",k=angular.element(c.parent()),n=m.getPadding(c[0]),q=m.getPadding(k[0]);a.options.rtl?"vertical"==a.options.displayMode?a.isRoot(b)?(r=0,h=-(k[0].offsetWidth+16)):(r-=q.top,l=k[0].offsetWidth-8):a.isRoot(b)?(r=c[0].offsetTop-n.bottom+c[0].offsetHeight,l=0):(r-=q.top,l=k[0].offsetWidth-8):"vertical"==a.options.displayMode?(r=a.isRoot(b)?0:r-q.top,h=k[0].offsetWidth-8):a.isRoot(b)?(r=c[0].offsetTop-n.bottom+c[0].offsetHeight,h=0):(r-=q.top,h=k[0].offsetWidth-8);c="display:block;"+("top:"+r+"px;");"auto"!=h&&(c+="left:"+h+"px;");"auto"!=l&&(c+="right:"+l+"px;");(b=D(a.getParent(b)))&&b.data&&g<b.data.length&&(b.data[g].inlineBlockStyle=c,p.$apply())}f(function(){A(d);I()},1)}}}};a.closeItem=function(b){var c=a.getElemFromItem(b);if(b&&p&&c){var d=c.find("ul");0<d.length&&0!=a.callClose(b)&&(d=angular.element(d.eq(0)),w(d),z(b)&&(a.isRoot(b)?"hovered"==a.getObjState(b)&&(a.options.rtl?c.addClass(a.options.controlStyle.block.marker.expand.rtlDown):c.addClass(a.options.controlStyle.block.marker.expand.down)):a.options.rtl?c.addClass(a.options.controlStyle.block.marker.expand.left):c.addClass(a.options.controlStyle.block.marker.expand.right)),c=a.getItemIndex(b),0<=c&&(b=D(a.getParent(b)))&&b.data&&c<b.data.length&&(b.data[c].inlineBlockStyle="display:none;",p.$apply()))}};var q=function(){a.closeItem(e);t=!1;e=null;a.refresh(null,!0);n&&f.cancel(n);n=null},n=null,p=null,z=function(b){if(b){var c=b[a.options.dataFields.items];return b[a.options.dataFields.hasChildren]||c&&0<c.length}return!1},K=function(b,c,d){var f="";b[a.options.dataFields.icon]||""==b[a.options.dataFields.icon]?f=b[a.options.dataFields.icon]:a.options.itemIcon&&(f=a.options.itemIcon);return{icon:f,iconVisible:0!=a.options.showIcons&&(null!=b.icon||null!=a.options.itemIcon),index:c,inlineBlockStyle:"display:none",item:b,style:{},visible:d}},G=function(b){var c=[];if(b)for(var d=0;d<b.length;d++)c.push(K(b[d],a.getItemFullIndex(b[d])));return c},I=function(){var a=u.find("li");if(0<a.length)for(var b=0;b<a.length;b++)for(var c=angular.element(a[b]),d=c.children(),f=0;f<d.length;f++){var e=angular.element(d[f]);e[0].attributes["data-element"]&&"load-icon"==e[0].attributes["data-element"].value.toString()&&e.css("top",(c[0].clientHeight-e[0].offsetHeight)/2+"px")}},L=function(){var a=u.find("li");if(0<a.length)for(var b=0;b<a.length;b++){var c=angular.element(a[b]);c&&c.attr("data-index",b)}},J=function(a,b){var c=null;if(a&&b)for(var d=0;!c&&d<a.length;)c=a[d].item==b?a[d]:J(a[d].data,b),d++;return c},D=function(a){return a?J(p.data,a):p},M=function(b){var e=f(function(){w();a.options.rtl?d.css("direction","rtl"):d.css("direction","ltr");b||(u.empty(),p&&p.$destroy());f.cancel(e)},1),g=f(function(){var d="";if(b){var e=D(b);if(e){var l=b[a.options.dataFields.items];if(l&&0<l.length){e.data=G(l);a.refresh();p.$apply();for(var h=0;h<l.length;h++)d+=H(h,l[h],e.scopeRef,e.data);""!=d&&(e=a.getBlockElemFromItem(b))&&(e.empty(),e.append(c(d)(p)))}L()}}else{p=k.$new();p.data=G(a.currentList);a.refresh();p.$apply();for(e=0;e<a.currentList.length;e++)d+=H(e,a.currentList[e],"data",p.data);""!=d&&u.append(c(d)(p))}A();var m=f(function(){I();f.cancel(m)},1);f.cancel(g)},1)},H=function(b,c,d,f){a.getItemFullIndex(c);var e='<li iui-class="{{'+d+"["+b+'].style.general}}" data-index="'+a.getItemFullIndex(c)+'">';switch(c.type){case "separator":e+='<hr iui-class="{{'+d+"["+b+'].style.separator}}" data-element="separator" />';break;default:e=e+('<span iui-class="{{'+d+"["+b+'].icon}}" data-element="icon" ng-show="'+d+"["+b+'].iconVisible"></span>')+('<span iui-class="{{'+d+"["+b+'].style.content}}"  data-element="content">'),e+="{{"+d+"["+b+"].item."+a.options.dataFields.text+"}}",e+="</span>",e+='<span iui-class="{{'+d+"["+b+'].style.loadIcon}}" data-element="load-icon"></span>'}var g=c[a.options.dataFields.items];if(c[a.options.dataFields.hasChildren]||g&&0<g.length){e+='<ul iui-class="{{'+d+"["+b+"].style.block";switch(a.options.displayMode){case "vertical":e=a.options.rtl?e+'.marker.right}}"':e+'.marker.left}}"';break;default:e=a.options.rtl?a.isRoot(c)?e+'.marker.rtlTop}}"':e+'.marker.right}}"':a.isRoot(c)?e+'.marker.top}}"':e+'.marker.left}}"'}e+=' iui-style="{{'+d+"["+b+'].inlineBlockStyle}}">';d+="["+b+"].data";f[b].data=G(g);f[b].scopeRef=d;if(g&&0<g.length)for(c=0;c<g.length;c++)e+=H(c,g[c],f[b].scopeRef,f[b].data);e+="</ul>"}return e+="</li>"};a.updateLayout=function(b){a.allowUpdate&&(a.updateCurrentList(),a.updateFullList(),M(b))};a.refresh=function(b,c){if(p)if(b)switch(b.type){default:var e=D(b);if(e){var f=z(b),g=a.getObjState(b),l={block:a.defaultStyle.block,content:"",general:"",label:"",loadIcon:"",separator:a.defaultStyle.item.separator},h="";switch(b.type){case "root":"vertical"==a.options.displayMode?(h=a.defaultStyle.root.general.vertical,a.options.controlStyle.root.general.vertical!=h&&(h+=" "+a.options.controlStyle.root.general.vertical)):(h=a.defaultStyle.root.general.normal,a.options.controlStyle.root.general.normal!=h&&(h+=" "+a.options.controlStyle.root.general.normal),f&&(h=a.options.rtl?h+(" "+a.defaultStyle.block.marker.expand.rtlSpace):h+(" "+a.defaultStyle.block.marker.expand.space)));l.general=h;h=a.defaultStyle.root.content;a.options.controlStyle.root.content!=h&&(h+=" "+a.options.controlStyle.root.content);l.content=h;h=a.defaultStyle.root.loadIcon.general;a.options.controlStyle.root.loadIcon.general!=h&&(h+=" "+a.options.controlStyle.root.loadIcon.general);a.options.rtl&&(h+="-rtl");l.loadIcon=h;break;default:h=a.defaultStyle.item.general.normal,a.options.controlStyle.item.general.normal!=h&&(h+=" "+a.options.controlStyle.item.general.normal),l.general=h,h=a.defaultStyle.item.content,a.options.controlStyle.item.content!=h&&(h+=" "+a.options.controlStyle.item.content),l.content=h,h=a.defaultStyle.item.loadIcon.general,a.options.controlStyle.item.loadIcon.general!=h&&(h+=" "+a.options.controlStyle.item.loadIcon.general),a.options.rtl&&(h+="-rtl"),l.loadIcon=h}h="";switch(b.type){case "separator":f?(h=a.getCurrentRootStyle(b).separator,h!=a.options.controlStyle.root.separator&&(l.separator+=" "+h)):(h=a.getCurrentItemStyle(b).separator,h!=a.options.controlStyle.item.separator&&(l.separator+=" "+h));break;case "root":var k=a.getCurrentRootStyle(b),h=a.getCurrentRootStyle(b,g);"vertical"==a.options.displayMode?("normal"!=g&&h!=a.options.controlStyle.root.general.vertical&&(l.general+=" "+h),!f||(1!=a.options.showDropDownIcon||0!=b[a.options.dataFields.selected])&&t&&C(b)||1!=a.options.showDropDownIcon&&"hovered"!=g||a.options.loadItem||(l.general=a.options.rtl?l.general+(" "+a.options.controlStyle.block.marker.expand.left):l.general+(" "+a.options.controlStyle.block.marker.expand.right))):(h!=a.options.controlStyle.root.general.normal&&(l.general+=" "+h),!f||(1!=a.options.showDropDownIcon||0!=b[a.options.dataFields.selected])&&t&&C(b)||1!=a.options.showDropDownIcon&&"hovered"!=g||a.options.loadItem||(l.general=a.options.rtl?l.general+(" "+a.options.controlStyle.block.marker.expand.rtlDown):l.general+(" "+a.options.controlStyle.block.marker.expand.down)));h=k.content;h!=a.options.controlStyle.root.content&&(l.content+=" "+h);b==a.options.loadItem&&(h=k.loadIcon.icon,l.loadIcon+=" "+h,h!=a.options.controlStyle.root.loadIcon.icon&&(l.loadIcon+=" "+h));break;default:k=a.getCurrentItemStyle(b),h=a.getCurrentItemStyle(b,g),h!=a.options.controlStyle.item.general.normal&&(l.general+=" "+h),f&&"selected"!=g&&!a.options.loadItem&&(l.general=a.options.rtl?l.general+(" "+a.options.controlStyle.block.marker.expand.left):l.general+(" "+a.options.controlStyle.block.marker.expand.right)),h=k.content,h!=a.options.controlStyle.item.content&&(l.content+=" "+h),b==a.options.loadItem&&(h=k.loadIcon.icon,l.loadIcon+=" "+h,h!=a.options.controlStyle.item.loadIcon.icon&&(l.loadIcon+=" "+h))}e.style=l;void 0==c&&p.$apply()}}else{e=a.defaultStyle.general.normal;a.options.controlStyle&&(e!=a.options.controlStyle.general.normal&&(e+=" "+a.options.controlStyle.general.normal),0==a.options.enabled&&a.options.controlStyle.general.disabled&&m.isString(a.options.controlStyle.general.disabled)&&(e+=" "+a.options.controlStyle.general.disabled));d.removeAttr("class");d.addClass(e);for(e=0;e<a.fullList.length;e++)a.fullList[e][a.options.dataFields.selected]=!1;for(e=a.hoverItem;e;)e[a.options.dataFields.selected]=!0,e=a.getParent(e);for(e=0;e<a.fullList.length;e++)a.refresh(a.fullList[e],!1);1==c&&p.$apply()}};var x=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(x.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",d[0].scrollTop+"px"),this.$tw.css("left",d[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",d[0].scrollTop+"px"),this.$tw.css("left",d[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=f(function(){x.trActive||(x.trCount=0,x.trActive=!0,x.trId=g(function(){x.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(g.cancel(this.trId),this.trId=null);this.trlTime&&(f.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};d.append(this.$tw);this.s1t(this.twp);angular.isDefined(k.options)?a.updateOptions(k.options):(angular.isDefined(k.controlStyle)&&a.updateControlStyle(k.controlStyle),0==k.enabled&&(a.options.enabled=k.enabled),angular.isDefined(k.itemIcon)&&(a.options.itemIcon=k.itemIcon),1==k.openOnHover&&(a.options.openOnHover=k.openOnHover),angular.isDefined(k.displayMode)&&(a.options.displayMode=k.displayMode),1==k.rtl&&(a.options.rtl=k.rtl),1==k.showDropdownIcon&&(a.options.showDropDownIcon=k.showDropdownIcon),0==k.showIcons&&(a.options.showIcons=k.showIcons));a.updateLayout();k.$on("$destroy",function(a){x.s2t();angular.element(y).unbind("click keydown");w();p&&p.$destroy()})}}}]);