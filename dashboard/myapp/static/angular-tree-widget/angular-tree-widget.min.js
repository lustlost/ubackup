/*
 @license Angular TreeWidget version 1.0.1
 ⓒ 2016 Alex Suleap https://github.com/AlexSuleap/agular-tree-widget
 License: MIT
 */
'use strict';
!function (e) {
    "use strict";
    e.module("TreeWidget", ["ngAnimate", "RecursionHelper"]).directive("tree", function () {
        return {
            restrict: "E",
            scope: {nodes: "=", options: "=?"},
            template: "<treenode nodes='nodes' tree='nodelist' options='options'></treenode>",
            compile: function (e, n, d) {
                return {
                    pre: function (e) {
                        function n(d, o) {
                            if (void 0 != d && d.length > 0)for (var t = 0; t < d.length; t++) {
                                var i = d[t];
                                void 0 === i.nodeId && (i.nodeId = "tree-node-" + e.count, e.count++), void 0 === i.expanded && void 0 != i.children && (i.expanded = !0), void 0 != o && (i.parentId = o.nodeId), -1 == e.nodelist.indexOf(i) && e.nodelist.push(i), n(i.children, i)
                            }
                        }

                        e.nodelist = [], e.options = e.options || (e.options = {
                                showIcon: !0,
                                expandOnClick: !1,
                                multipleSelect: !1
                            }), e.count = 0, e.$watch(function () {
                            n(e.nodes)
                        })
                    }
                }
            }
        }
    }).directive("treenode", ["RecursionHelper", function (n) {
        return {
            restrict: "E",
            scope: {nodes: "=", tree: "=", options: "=?"},
            template: '<ul><li ng-repeat="node in nodes" class="node"><i class="tree-node-ico pointer" ng-class="{\'tree-node-expanded\': node.expanded,\'tree-node-collapsed\':!node.expanded && node.children}" ng-click="toggleNode(node)">展开</i><span class="node-title pointer" ng-click="selectNode(node)" ng-class="{\'disabled\':node.disabled}"><span><i class="tree-node-ico" ng-if="options.showIcon" ng-class="{\'tree-node-image\':node.children, \'tree-node-leaf\':!node.children}" ng-style="node.image && {\'background-image\':\'url(\'+node.image+\')\'}"></i><span class="node-name" ng-class="{selected: node.selected&& !node.disabled}">{{node.name}}</span></span></span><treenode ng-if="node.children" nodes=\'node.children\' tree="tree" options="options" ng-show="node.expanded" id="{{node.nodeId}}"></treenode></li></ul>',
            compile: function (d) {
                return n.compile(d, function (n, d, o, t, i) {
                    n.selectNode = function (d) {
                        d.disabled || (n.options.multipleSelect ? (d.selected = !d.selected, n.$emit("selection-changed", n.tree.filter(function (e) {
                            return e.selected
                        }))) : (d.selected = !0, e.forEach(n.tree, function (e) {
                            d != e && (e.selected = !1)
                        }), n.$emit("selection-changed", d)), n.options.expandOnClick && void 0 != d.children && (d.expanded = !d.expanded, n.$emit("expanded-state-changed", d)))
                    }, n.toggleNode = function (e) {
                        void 0 != e.children && (e.expanded = !e.expanded, n.$emit("expanded-state-changed", e))
                    }
                })
            }
        }
    }])
}(angular);